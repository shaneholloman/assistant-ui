---
title: Hooks
---

## Higher Order Hooks

Higher order hooks can be built in userland using primitive hooks.
They are included in tap for convenience, linter integration, better diagnostics, etc.


### `tapRef`

```ts
const tapRef = (initialValue) => {
  const [ref] = tapState(() => ({ current: initialValue }));
  return ref;
}
```

### `tapState`


```ts
const tapStateReducer = (prevState, newState) =>
	typeof newState === 'function' ? newState(prevState) : newState

const tapStateInitializer = (initialValue) =>
	typeof initialValue === 'function' ? initialValue() : initialValue

const tapState = (initialValue) => {
  return tapReducer(tapStateReducer, initialValue, tapStateInitializer)
}
```


### `tapEffectEvent`

```ts
const tapEffectEvent = () => {

}
```

## Primitive Hooks

If a hook can't be composed through other hooks, it is considered a primitive hook.

### `tapEffect`

```ts
const tapEffect = (effect, deps) => {
  const hook = tapHook("effect");

  if (!shallowDepsEqual(hook.deps, deps)) {
    registerRenderMountTask(() => {
      hook.cleanup?.();
      hook.cleanup = effect();
      hook.deps = deps;
    })
  }
}
```

### `tapMemo`

```ts
const tapMemo = (memo, deps) => {
  const hook = tapHook("memo");

  const prev = getHookValue(hook);
  if (prev && shallowDepsEqual(prev.deps, deps)) return prev;
  
  const value = memo();
  setHookValue(hook, { value, deps });

  return value;
}
```

### `tapReducer`

```ts
const tapReducer = (reducer, initialArg, init) => {
  const hook = tapHook("reducer");

  if (!hook.dispatch) {
    hook.dispatch = (action) => {
      dispatchGlobal(() => {
        const currentValue = getHookValue(hook);
        const newValue = reducer(action);
        if (Object.is(currentValue, newValue)) return false;

        setHookValue(hook, newValue);
        return true;
      });
    }

    const value = init ? init(initialArg) : initialArg
    setHookValue(value);
    return [value, hook.dispatch];
  } else {
    const value = getHookValue(hook);
    return [value, hook.dispatch];
  }
}
```




## Hook Authoring API

### `tapHook`

### `getHookValue`

// if we are outside a render: return hook value


### `setHookValue`

// if we are outside a render: set hook value
// if we are inside a render: 



```ts
let renderScope = null;
const useRenderScope = (fiber) => {
  try {
    return useReducer(versionReducer, 0);
  } finally {
    lane = null;
  }
}

const createRenderScope = () => ({
  
})

const renderScope = useMemo(createRenderScope, [fiber.commitVersion]);
const [version, dispatchUpdate] = useRenderScope(fiber)
```