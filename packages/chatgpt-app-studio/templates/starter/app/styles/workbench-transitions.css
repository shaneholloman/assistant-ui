/*
  Workbench app container morph transition
  Used when transitioning between inline and fullscreen display modes.

  Border-radius direction is controlled via CSS custom properties:
  --morph-radius-from / --morph-radius-to (set by JS before transition)

  Uses nested view transition groups (CSS View Transitions Level 2) to
  respect the parent container's overflow clipping during transitions.
*/

@supports (view-transition-name: none) {
  /* Parent container - establishes clipping boundary */
  ::view-transition-group(workbench-preview-panel) {
    overflow: clip;
  }

  /* Child container - nested under parent to respect clipping */
  ::view-transition-group(workbench-app-container) {
    animation-duration: 350ms;
    animation-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
    overflow: clip;
    /* Instantly apply inline radius to clip corners from frame 0 */
    border-radius: 0.75rem;
  }

  ::view-transition-image-pair(workbench-app-container) {
    overflow: clip;
    border-radius: 0.75rem;
  }

  ::view-transition-old(workbench-app-container),
  ::view-transition-new(workbench-app-container) {
    animation-duration: 350ms;
    animation-timing-function: cubic-bezier(0.32, 0.72, 0, 1);
    mix-blend-mode: normal;
  }

  ::view-transition-old(workbench-app-container) {
    animation: workbench-morph-out 350ms cubic-bezier(0.32, 0.72, 0, 1) forwards;
  }

  ::view-transition-new(workbench-app-container) {
    animation: workbench-morph-in 350ms cubic-bezier(0.32, 0.72, 0, 1) forwards;
  }

  /*
    Composer transition - stays visible and static during mode transitions.
    Uses instant swap: old hides immediately, new shows immediately.
    This prevents the composer from flickering or showing duplicates.
  */
  ::view-transition-group(workbench-composer) {
    animation: none;
  }

  ::view-transition-old(workbench-composer) {
    animation: none;
    opacity: 0;
  }

  ::view-transition-new(workbench-composer) {
    animation: none;
    opacity: 1;
  }

  @keyframes workbench-morph-out {
    0% {
      opacity: 1;
    }
    70% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  @keyframes workbench-morph-in {
    0% {
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 1;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    ::view-transition-group(workbench-preview-panel),
    ::view-transition-group(workbench-app-container),
    ::view-transition-old(workbench-app-container),
    ::view-transition-new(workbench-app-container) {
      animation-duration: 0ms;
    }
  }
}
